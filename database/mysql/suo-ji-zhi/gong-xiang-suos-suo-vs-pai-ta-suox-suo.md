---
description: 在 MySQL 的锁机制中，根据锁的 属性，主要分为 共享锁（S 锁） 和 排他锁（X 锁），此外，还有 意向锁 作为辅助机制。
cover: >-
  https://images.unsplash.com/photo-1738444515789-0a1a4c4982dc?crop=entropy&cs=srgb&fm=jpg&ixid=M3wxOTcwMjR8MHwxfHJhbmRvbXx8fHx8fHx8fDE3MzkzNzI3MjZ8&ixlib=rb-4.0.3&q=85
coverY: 0
---

# 共享锁(S 锁)vs排他锁(X 锁)

## 📌 **1. 共享锁（Shared Lock, S 锁）**

### **概念**

* 共享锁允许多个事务同时读取相同的数据，但 **不能修改** 该数据。
* 适用于**只读**场景，如报表查询、快照读取等。

### **示例**

```sql
SELECT * FROM users WHERE id = 1 LOCK IN SHARE MODE;
```

### 行为

* 其他事务 可以 获取 S 锁进行读取。
* 其他事务 不能 获取 X 锁进行修改，必须等待当前 S 锁释放。

### 应用场景

* 防止“脏读”：在某些事务隔离级别下，确保读取的数据不会在查询过程中被其他事务修改。

## 2.排他锁（Exclusive Lock, X 锁）

### 概念

* 排他锁（X 锁）使得其他事务 不能 读取或修改该数据，直到当前事务释放该锁。
* 适用于更新操作，防止数据竞争。

### 示例

```sql
SELECT * FROM users WHERE id = 1 FOR UPDATE;
```

### 行为

* 其他事务 不能 获取 S 锁进行读取。
* 其他事务 不能 获取 X 锁进行修改。

### 应用场景

* 确保数据一致性：事务在修改数据时，确保其他事务不能访问未提交的数据，防止脏读或数据不一致。

## 3.意向锁（Intention Lock）

### 概念

* 意向锁 不是直接加在数据行上的，而是加在 表级别，用于表明某个事务打算对某些行加 S 锁或 X 锁。
* 作用：帮助 MySQL 处理表锁和行锁之间的冲突，避免全表扫描带来的锁冲突。

### 类型

| 意向锁类型                              | 作用               |
| ---------------------------------- | ---------------- |
| 意向共享锁（IS，Intention Shared Lock）    | 事务打算对表中的某些行加 S 锁 |
| 意向排他锁（IX，Intention Exclusive Lock） | 事务打算对表中的某些行加 X 锁 |

### 示例

```sql
SELECT * FROM users WHERE id = 1 LOCK IN SHARE MODE;
-- 事务会自动加 IS 锁
```

```sql
SELECT * FROM users WHERE id = 1 FOR UPDATE;
-- 事务会自动加 IX 锁
```

### 作用

* 避免表锁与行锁冲突：如果一个事务要锁住整个表（表级锁），可以先检查是否有其他事务持有行锁（行级锁），从而避免冲突。

## 4. 共享锁（S） vs. 排他锁（X） vs. 意向锁（IS/IX）

| **锁类型**          | **是否允许多个事务同时获取** | **是否允许读取** | **是否允许修改**  | **适用场景**         |
| ---------------- | ---------------- | ---------- | ----------- | ---------------- |
| **共享锁（S 锁）**     | ✅ 是              | ✅ 是        | ❌ 否         | 只读查询，防止数据被修改     |
| **排他锁（X 锁）**     | ❌ 否              | ❌ 否        | ❌ 否（除当前事务）  | 事务更新数据，防止其他事务访问  |
| **意向锁（IS/IX 锁）** | ✅ 是              | ✅ 是        | ✅ 是（仅 IX 锁） | 标记事务对数据的意图，减少锁冲突 |

