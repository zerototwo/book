---
cover: >-
  https://images.unsplash.com/photo-1735447286068-9eb314f5f4b4?crop=entropy&cs=srgb&fm=jpg&ixid=M3wxOTcwMjR8MHwxfHJhbmRvbXx8fHx8fHx8fDE3MzkzNzQxNjJ8&ixlib=rb-4.0.3&q=85
coverY: 0
---

# 意向共享锁（IS）与意向排他锁（IX）

## 1.什么是意向锁？

意向锁（Intention Locks）是 InnoDB 提供的一种 表级锁，用于表明 当前事务计划 对数据进行\*\*共享（读）或排他（写）\*\*操作。

它的主要作用是 避免全表扫描时的锁冲突，提高并发性能。

## 2.意向共享锁（IS - Intention Shared Lock）

1. 事务 计划 在表中某些行上加 共享锁（S 锁） 时，必须先在表级加 IS 锁。
2. 多个事务可以同时持有 IS 锁，因为它们只是声明 “我要读”。
3. 不会阻止其他事务获取 IS 或 IX 锁，但会阻止表级排他锁（X 锁）。

### 适用场景：

读操作

```sql
SELECT * FROM users LOCK IN SHARE MODE;
```

适用于需要 共享读取数据 的事务，多个事务可以同时读取相同数据而不影响彼此。

## 3.意向排他锁（IX - Intention Exclusive Lock）

* 事务 计划 在表中某些行上加 排他锁（X 锁） 时，必须先在表级加 IX 锁。
* 多个事务可以同时持有 IX 锁，但不能加表级 S 锁 或 X 锁，因为它们声明的是 “我要写”。
* 不会阻止其他事务获取 IS 或 IX 锁，但会阻止表级共享锁（S）和表级排他锁（X）。

适用场景：

写操作

```sql
SELECT * FROM users WHERE id = 1 FOR UPDATE;
```

适用于 更新或删除数据 时，确保其他事务不会获取整个表的共享锁或排他锁。



## 4. 意向锁冲突表

| 锁类型           | IS（意向共享锁） | IX（意向排他锁） | S（共享锁） | X（排他锁） |
| ------------- | --------- | --------- | ------ | ------ |
| **IS（意向共享锁）** | ✅ 兼容      | ✅ 兼容      | ✅ 兼容   | ❌ 冲突   |
| **IX（意向排他锁）** | ✅ 兼容      | ✅ 兼容      | ❌ 冲突   | ❌ 冲突   |
| **S（共享锁）**    | ✅ 兼容      | ❌ 冲突      | ✅ 兼容   | ❌ 冲突   |
| **X（排他锁）**    | ❌ 冲突      | ❌ 冲突      | ❌ 冲突   | ❌ 冲突   |

✅ **兼容**：多个事务可以同时持有该锁类型\
❌ **冲突**：当前锁阻止其他事务获取该锁类型

## 5.为什么需要意向锁？

**提升并发性能**

* 避免全表加锁，减少锁争用。
* 事务只需判断 表级锁 是否冲突，而不需要扫描全表。

**优化加锁策略**

* 事务获取 行级锁 时，必须先获取 表级意向锁，以便其他事务知道当前表的访问状态。

## &#x20;6. 总结

| 意向锁           | 作用                  | 适用场景                                    |
| ------------- | ------------------- | --------------------------------------- |
| **IS（意向共享锁）** | 事务声明 **即将** 读取表中某些行 | `SELECT … LOCK IN SHARE MODE`           |
| **IX（意向排他锁）** | 事务声明 **即将** 更新表中某些行 | `SELECT … FOR UPDATE / UPDATE / DELETE` |

***

#### 📌 关键点：

* **意向锁本身不阻塞其他事务**，只有当事务尝试获取**表级锁（S/X）** 时，才会受影响。
* **提高事务并发能力**，避免全表锁定，提高数据库吞吐量。

## 高频问题

**1.意向锁与共享锁、排他锁有什么区别？**

* 意向锁是 表级锁，用于标记事务 意图 访问的行。
* 共享锁（S）允许 多个事务同时读取数据。
* 排他锁（X）会 阻止其他事务访问数据，确保写操作安全。

**2.意向共享锁（IS）和意向排他锁（IX）会阻塞其他事务吗？**

* 不会阻塞 其他事务获取 IS/IX 锁，但会阻止表级 S/X 锁。

**3.意向锁如何提高 MySQL 并发性能？**

* 避免全表加锁，提高行级锁的管理效率。
* 事务不需要扫描整个表即可知道是否有行级锁存在，减少锁冲突。

