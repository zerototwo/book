---
description: >-
  TCC（Try-Confirm-Cancel）是一种分布式事务解决方案，相较于 2PC 和 3PC，它更加灵活，不依赖数据库锁，适用于
  高并发、微服务、分布式系统。
cover: >-
  https://images.unsplash.com/photo-1737798388229-2524c7777c60?crop=entropy&cs=srgb&fm=jpg&ixid=M3wxOTcwMjR8MHwxfHJhbmRvbXx8fHx8fHx8fDE3Mzk1NDc3NDF8&ixlib=rb-4.0.3&q=85
coverY: 0
---

# TCC (Try-Confirm-Cancel)

## 1.TCC 事务的基本流程

TCC 事务模型由 三个阶段 组成：

### 1.1Try（尝试阶段）：

* 预留资源，进行事务的初步检查。
* 例如，在资金转账中，Try 阶段会先锁定金额但不真正扣款。

### 2.Confirm（确认阶段）：

* 业务操作正式提交。
* 例如，扣款操作真正生效，资金从账户 A 转入账户 B。

### 3.Cancel（取消阶段）：

* 发生异常时，回滚预留的资源，恢复到 Try 之前的状态。

## 2.TCC 事务的执行示例

以 银行转账 为例：

* 用户 A 向用户 B 转账 100 元

### 2.1Try 阶段

* 用户 A 账户 冻结 100 元（但未真正扣款）
* 用户 B 账户真正增加 100 元

### 2.2Confirm 阶段

* 用户 A 账户真正扣除 100 元
* 用户 B 账户真正增加 100 元

### 2.3Cancel 阶段（异常回滚）

* 用户 A 账户解冻 100 元
* 用户 B 账户不变

## 3.TCC 事务的优势

✅ 降低数据库锁竞争：

* TCC 采用应用层控制事务，不会长期占用数据库锁，提高并发能力。

✅ 灵活适配业务逻辑：

* Try 阶段可以自定义业务校验逻辑，例如库存检查、权限校验等。

✅ 事务可恢复：

* 失败时可以 手动重试 或 定期扫描补偿，提升可用性。

## 4.TCC 事务的挑战

❌ 业务侵入性高：

* 需要应用开发者实现 Try / Confirm / Cancel 三个操作，开发成本较高。

❌ 回滚复杂：

* 由于 TCC 事务是分布式的，Cancel 阶段需要设计幂等性和事务补偿机制，否则可能导致数据不一致。

❌ 并发控制难度大：

* 例如，两个并发事务可能导致相同资源被 Try 预留，但最后只有一个事务能成功。

## 5.适用场景

✅ 微服务架构

* 适用于电商、支付、库存管理等分布式业务。

✅ 高并发系统

* 适用于 大规模并发交易，如 秒杀、订单处理。

✅ 无数据库锁的业务

* 例如 Redis 缓存事务、消息队列事务。

## 总结

* TCC 事务是一种轻量级分布式事务解决方案，适用于高并发、分布式环境。
* 相比 2PC/3PC，它避免了数据库锁竞争，但需要业务端实现事务控制。
* 适合微服务架构，如支付、库存、订单等场景。







